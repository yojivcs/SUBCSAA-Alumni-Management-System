<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Events</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Lexend', sans-serif;
      background-color: #f8f9fa;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 250px;
      height: 100%;
      background-color: #5E3792;
      box-shadow: 4px 0px 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar a {
      color: white;
      display: block;
      padding: 16px;
      text-decoration: none;
      transition: background-color 0.3s;
    }

    .sidebar a:hover {
      background-color: #4B2C6F;
      color: white;
    }

    .content {
      margin-left: 250px;
      padding: 20px;
      background: linear-gradient(45deg, #F9F9F9, #F1F1F1);
    }

    .event-form {
      background: white;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      margin-bottom: 32px;
    }

    .form-title {
      color: #1F2937;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 24px;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #E5E7EB;
      border-radius: 8px;
      margin-bottom: 16px;
      font-family: 'Lexend', sans-serif;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #5E3792;
      box-shadow: 0 0 0 3px rgba(94, 55, 146, 0.1);
    }

    .form-label {
      display: block;
      color: #4B5563;
      font-size: 0.95rem;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .submit-btn {
      background-color: #5E3792;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 8px;
    }

    .submit-btn:hover {
      background-color: #4B2C6F;
      transform: translateY(-2px);
    }

    .event-card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      margin-bottom: 16px;
      transition: all 0.3s ease;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .event-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .event-title {
      color: #1F2937;
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .event-info {
      color: #4B5563;
      font-size: 0.95rem;
      margin: 8px 0;
    }

    .delete-btn {
      background-color: #DC2626;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.3s ease;
      margin-top: 16px;
    }

    .delete-btn:hover {
      background-color: #B91C1C;
      transform: translateY(-2px);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 9999px;
      font-size: 0.875rem;
      font-weight: 500;
      text-transform: capitalize;
    }

    .status-upcoming {
      background-color: #10B981;
      color: white;
    }

    .status-past {
      background-color: #6B7280;
      color: white;
    }

    .status-featured {
      background-color: #6366F1;
      color: white;
    }
  </style>
</head>
<body class="bg-gray-100">
  <!-- Sidebar Container -->
  <div id="sidebar-container"></div>
  <div class="flex flex-row">
    <!-- Sidebar space -->
    <div class="w-64"></div>
    <div class="container mx-auto mt-10 ml-12">
      <h1 class="text-3xl font-bold mb-8 text-gray-800">Manage Events</h1>

      <!-- Add Event Form -->
      <form id="add-event-form" class="event-form">
        <h2 class="form-title">Add New Event</h2>
        
        <div class="mb-4">
          <label class="form-label" for="title">Event Title</label>
          <input type="text" id="title" placeholder="Enter event title" class="form-input">
        </div>

        <div class="mb-4">
          <label class="form-label" for="description">Event Description</label>
          <textarea id="description" placeholder="Enter event description" class="form-input" rows="4"></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="form-label" for="event_date">Event Date</label>
            <input type="date" id="event_date" class="form-input">
          </div>
          <div>
            <label class="form-label" for="location">Event Location</label>
            <input type="text" id="location" placeholder="Enter location" class="form-input">
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label" for="status">Event Status</label>
          <select id="status" class="form-input">
            <option value="upcoming">Upcoming</option>
            <option value="past">Past</option>
            <option value="featured">Featured</option>
          </select>
        </div>

        <button type="submit" class="submit-btn">Add Event</button>
      </form>

      <!-- Events List -->
      <div id="events-container" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <!-- Events will be dynamically loaded here -->
      </div>
    </div>
  </div>

  <!-- Load Sidebar Script -->
  <script>
    // Load Sidebar
    document.addEventListener('DOMContentLoaded', function () {
      document.getElementById('sidebar-container').innerHTML = `
        <div class="sidebar">
          <h2 class="text-white text-xl font-bold p-4">Admin Dashboard</h2>
          <a href="/private/admin/dashboard.html">Dashboard</a>
          <a href="/private/admin/manage_users.html">Manage Users</a>
          <a href="/private/admin/alumni_directory.html">Alumni Directory</a>
          <a href="/private/admin/manage_events.html">Manage Events</a>
          <a href="/private/admin/manage_jobs.html">Manage Job Posts</a>
          <a href="/private/admin/logout.html">Logout</a>
        </div>
      `;
    });

    // Fetch and Display Events
    function fetchEvents() {
      fetch('/php/get_events.php')
        .then(response => response.json())
        .then(events => {
          const container = document.getElementById('events-container');
          container.innerHTML = '';
          events.forEach(event => {
            const eventCard = document.createElement('div');
            eventCard.className = 'event-card';

            const statusClass = `status-${event.status}`;
            
            eventCard.innerHTML = `
              <h3 class="event-title">${event.title}</h3>
              <p class="event-info">${event.description}</p>
              <p class="event-info"><strong>Date:</strong> ${event.date}</p>
              <p class="event-info"><strong>Location:</strong> ${event.location}</p>
              <div class="flex items-center justify-between mt-4">
                <span class="status-badge ${statusClass}">${event.status}</span>
                <button onclick="deleteEvent(${event.id})" class="delete-btn">Delete Event</button>
              </div>
            `;
            container.appendChild(eventCard);
          });
        });
    }

    // Add Event
    document.getElementById('add-event-form').addEventListener('submit', function (e) {
      e.preventDefault();

      // Collect form data
      const title = document.getElementById('title').value.trim();
      const description = document.getElementById('description').value.trim();
      const event_date = document.getElementById('event_date').value.trim();
      const location = document.getElementById('location').value.trim();
      const status = document.getElementById('status').value.trim();

      // Validate input
      if (!title || !description || !event_date || !location || !status) {
        alert('All fields are required!');
        return;
      }

      // Create form data to send
      const formData = new FormData();
      formData.append('title', title);
      formData.append('description', description);
      formData.append('event_date', event_date);
      formData.append('location', location);
      formData.append('status', status);

      // Send POST request to backend
      fetch('/php/add_event.php', {
        method: 'POST',
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.success) {
            alert('Event added successfully!');
            // Clear form
            e.target.reset();
            fetchEvents(); // Reload events
          } else {
            alert('Error adding event: ' + data.error);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
          alert('An error occurred while adding the event.');
        });
    });

    // Delete Event
    function deleteEvent(eventId) {
      if (confirm('Are you sure you want to delete this event?')) {
        fetch('/php/delete_event.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ event_id: eventId }),
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Event deleted successfully');
              fetchEvents();
            } else {
              alert('Error: ' + data.error);
            }
          });
      }
    }

    // Fetch events on page load
    fetchEvents();
  </script>
</body>
</html>
